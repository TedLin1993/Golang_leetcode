package leetcode

import "fmt"

func validUtf8(data []int) bool {
	if len(data) == 1 {
		return data[0] < 1<<7
	}

	remainByteLength := 0
	index := 0
	for index < len(data) {
		if remainByteLength > 0 {
			if !isFollowingByte(data[index]) {
				return false
			}
		} else {
			remainByteLength = countByteLength(data[index])
			// if it is a 1-byte character, remainByteLength should be 0
			// and a character is limit to 1 ~ 4 bytes
			if remainByteLength == 1 || remainByteLength > 4 {
				return false
			}
		}
		remainByteLength--
		index++
	}
	return remainByteLength <= 0
}

func countByteLength(firstByteInt int) int {
	length := 0
	bitLayer := 1 << 7
	limit := 1 << 3
	for firstByteInt&bitLayer != 0 && bitLayer >= limit {
		length++
		bitLayer >>= 1
	}
	return length
}

func isFollowingByte(byteInt int) bool {
	// fisrt 2 bit must be 10
	firstBit := 1 << 7
	secondBit := 1 << 6
	return byteInt&firstBit != 0 && byteInt&secondBit == 0
}

func Test_validUtf8() {
	fmt.Println(validUtf8([]int{1}))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         //true
	fmt.Println(validUtf8([]int{197, 130, 1}))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               //true
	fmt.Println(validUtf8([]int{235, 140, 4}))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               //false
	fmt.Println(validUtf8([]int{240, 162, 138, 147, 145}))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   //false
	fmt.Println(validUtf8([]int{250, 145, 145, 145, 145}))                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   //false
	fmt.Println(validUtf8([]int{99, 108, 97, 255, 115, 32, 83, 111, 108, 117, 116, 105, 111, 110, 32, 123, 13, 10, 112, 117, 98, 108, 105, 99, 58, 13, 10, 32, 32, 32, 32, 98, 111, 111, 108, 32, 118, 97, 108, 105, 100, 95, 117, 116, 102, 56, 40, 118, 101, 99, 116, 111, 114, 60, 105, 110, 116, 62, 38, 32, 100, 97, 116, 97, 41, 32, 123, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 105, 110, 116, 32, 99, 111, 117, 110, 116, 32, 61, 32, 48, 59, 13, 10, 32, 32, 32, 32, 9, 102, 111, 114, 40, 97, 117, 116, 111, 32, 99, 32, 58, 32, 100, 97, 116, 97, 41, 32, 123, 13, 10, 32, 32, 32, 32, 9, 9, 105, 102, 40, 99, 111, 117, 110, 116, 32, 61, 61, 32, 48, 41, 32, 123, 13, 10, 32, 32, 32, 32, 9, 32, 32, 9, 9, 47, 42, 42, 32, 115, 101, 116, 32, 116, 104, 101, 32, 114, 101, 109, 97, 105, 110, 101, 100, 32, 116, 104, 101, 32, 117, 116, 102, 45, 56, 32, 99, 104, 97, 114, 32, 99, 111, 117, 110, 116, 32, 42, 42, 47, 13, 10, 32, 32, 32, 32, 9, 32, 32, 9, 9, 105, 102, 40, 40, 99, 32, 62, 62, 32, 53, 41, 32, 61, 61, 32, 48, 98, 49, 49, 48, 41, 32, 32, 99, 111, 117, 110, 116, 32, 61, 32, 49, 59, 13, 10, 32, 32, 32, 32, 9, 32, 32, 9, 9, 101, 108, 115, 101, 32, 105, 102, 40, 40, 99, 32, 62, 62, 32, 52, 41, 32, 61, 61, 32, 48, 98, 49, 49, 49, 48, 41, 32, 32, 32, 99, 111, 117, 110, 116, 32, 61, 32, 50, 59, 13, 10, 32, 32, 32, 32, 9, 32, 32, 9, 9, 101, 108, 115, 101, 32, 105, 102, 40, 40, 99, 32, 62, 62, 32, 51, 41, 32, 61, 61, 32, 48, 98, 49, 49, 49, 49, 48, 41, 32, 32, 99, 111, 117, 110, 116, 32, 61, 32, 51, 59, 13, 10, 32, 32, 32, 32, 9, 32, 32, 9, 9, 101, 108, 115, 101, 32, 105, 102, 40, 40, 99, 32, 62, 62, 32, 55, 41, 41, 32, 32, 32, 114, 101, 116, 117, 114, 110, 32, 102, 97, 108, 115, 101, 59, 13, 10, 32, 32, 32, 32, 9, 32, 32, 9, 125, 32, 101, 108, 115, 101, 32, 123, 13, 10, 32, 32, 32, 32, 9, 32, 32, 32, 32, 32, 32, 32, 32, 105, 102, 40, 40, 99, 32, 62, 62, 32, 54, 41, 32, 33, 61, 32, 48, 98, 49, 48, 41, 32, 32, 32, 114, 101, 116, 117, 114, 110, 32, 102, 97, 108, 115, 101, 59, 13, 10, 32, 32, 32, 32, 9, 32, 32, 32, 9, 9, 99, 111, 117, 110, 116, 45, 45, 59, 13, 10, 32, 32, 32, 32, 9, 32, 32, 9, 125, 13, 10, 32, 32, 32, 32, 9, 125, 13, 10, 32, 32, 32, 32, 32, 32, 32, 32, 114, 101, 116, 117, 114, 110, 32, 99, 111, 117, 110, 116, 32, 61, 61, 32, 48, 59, 13, 10, 32, 32, 32, 32, 125, 13, 10, 125, 59, 13, 10})) //false
}
